<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Open Voice Factory - Grid Generation</title>
    <link rel="stylesheet" type="text/css" href="ovf.css">
</head>

<body>
    <div id="columns">
        <img src="eqt_logo.png" height="180" alt="EQT Logo">
        <h1>The Open Voice Factory</h1>
        <h2>Grid Generation</h2>

        <p>To create your own communication aid, follow these steps:</p>
        <ol>
            <li>Make some changes to the templates (download them from the main site) </li>
            <li>Upload your version using the form below.</li>
        </ol>

        <form action="upload.php" method="post" enctype="multipart/form-data" class="file-submit" id="uploadForm">
            <fieldset>
                <legend>Upload Form</legend>
                <h3>File to upload</h3>
                <p>The Open Voice Factory is simple. No usernames, no passwords. Just upload a template and youâ€™ll be given a special link to always access the communication device you created.</p>
                <label for="fileToUpload">Choose a file:</label>
                <input type="file" name="fileToUpload" id="fileToUpload" required>
                <br>
                <h3>Grid size</h3>
                <label>
                    <input type="radio" name="size" value="5" class="size" required>
                    5 wide and 5 tall
                </label>
                <br>
                <label>
                    <input type="radio" name="size" value="4" class="size">
                    4 wide and 4 tall
                </label>
                <br>
                <progress id="uploadProgress" value="0" max="100"></progress> <!-- Progress bar -->
                <br>
                <div id="status"></div>
                <button class="button" type="submit" data-tooltip="Please select a file and a grid size first!">Process uploaded file</button>
            </fieldset>
        </form>
    </div>

    <script>
        document.getElementById('uploadForm').addEventListener('submit', function (e) {
            e.preventDefault();
            var form = e.target;
            var formData = new FormData(form);

            var xhr = new XMLHttpRequest();
            xhr.open(form.method, form.action, true);
            document.getElementById('status').textContent="Uploading"; 
            xhr.upload.addEventListener('progress', function (e) {
                if (e.lengthComputable) {
                    var percentComplete = (e.loaded / e.total) * 100;
                    document.getElementById('uploadProgress').value = percentComplete;
                }
            });

            xhr.addEventListener('load', function () {
                if (xhr.status == 200) {
                    // Handle success actions here
                    document.getElementById('status').textContent="Uploaded and processing"; 
                    document.getElementById('uploadForm').submit();
                } else {
                    document.getElementById('status').textContent="Upload failed"; 
                    // Handle error actions here
                }
            });

            xhr.send(formData);
        });
    </script>
</body>

</html>

